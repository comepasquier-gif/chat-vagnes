<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chat Chavagnes</title>
<meta name="theme-color" content="#0ea5a4">
<style>
body {
  margin:0;
  font-family: 'Arial', sans-serif;
  background: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT5_2q9CKo6j52ret7quZBcpcC7tCxn7zNdfw&s') no-repeat center center fixed;
  background-size: cover;
  color:#fff;
  height:100vh;
  display:flex;
  flex-direction:column;
}
header, footer {
  padding:10px;
  background: rgba(11,18,32,0.8);
  display:flex;
  align-items:center;
  gap:8px;
}
main {
  flex:1;
  overflow:auto;
  padding:10px;
  background: rgba(0,0,0,0.2);
  border-top:2px solid #0ea5a4;
  border-bottom:2px solid #0ea5a4;
}
input, button {
  padding:8px;
  border-radius:6px;
  border:none;
}
input { flex:1; }
button {
  background:#0ea5a4;
  color:#022;
  cursor:pointer;
}
.msg{
  padding:6px 10px;
  border-radius:8px;
  margin:4px 0;
  max-width:70%;
  display:inline-block;
}
.mine{background:#0ea5a4;color:#022;margin-left:auto;}
.other{background:#1e293b;}
.meta{font-size:11px;color:#94a3b8;margin-top:3px;}
img.avatar {
  width:24px;
  height:24px;
  border-radius:50%;
  vertical-align:middle;
  margin-right:6px;
}
.adminTag {
  background:#facc15;
  color:#222;
  padding:2px 4px;
  border-radius:4px;
  font-size:11px;
  margin-left:4px;
}
</style>
</head>
<body>
<header>
  <img class="avatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="avatar">
  <input id="nick" type="text" placeholder="Pseudo" value="User">
</header>

<main id="messages"></main>

<footer>
  <input id="inputMsg" type="text" placeholder="Ton message...">
  <button id="sendBtn">Envoyer</button>
</footer>

<!-- âœ… Firebase SDK en compat -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
// ðŸ”¹ Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDP-H6X01nM42PGb1Wym7RCaWrsugrL5vA",
  authDomain: "minichat-fc8fc.firebaseapp.com",
  databaseURL: "https://minichat-fc8fc-default-rtdb.europe-west1.firebasedatabase.app/",
  projectId: "minichat-fc8fc",
  storageBucket: "minichat-fc8fc.firebasestorage.app",
  messagingSenderId: "614755534085",
  appId: "1:614755534085:web:3dd7799d11f5991c69236c"
};

// âœ… Initialisation
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const msgEl = document.getElementById("messages");
const nickEl = document.getElementById("nick");
const inputMsg = document.getElementById("inputMsg");
const sendBtn = document.getElementById("sendBtn");

let isAdmin = false; // Ã©tat admin

// ðŸ”¹ Envoyer un message
function sendMessage(){
  const text = inputMsg.value.trim();
  if(!text) return;

  // --- VÃ©rification des commandes ---
  if(text === "/code adminlesang"){
    isAdmin = true;
    alert("âœ… Tu es maintenant ADMIN !");
    inputMsg.value="";
    return;
  }

  if(text === "/clear"){
    if(isAdmin){
      db.ref("messages").remove().then(()=>{
        msgEl.innerHTML = "";
        alert("ðŸ§¹ Tous les messages ont Ã©tÃ© effacÃ©s !");
      });
    }else{
      alert("â›” Seul un admin peut utiliser cette commande !");
    }
    inputMsg.value="";
    return;
  }

  // --- Envoi normal ---
  const nick = nickEl.value || "Anonyme";
  db.ref("messages").push({
    nick,
    text,
    admin: isAdmin,
    t: Date.now()
  }).then(()=>{
    inputMsg.value="";
  }).catch(err=>{
    alert("Erreur dâ€™envoi : " + err.message);
  });
}

sendBtn.onclick = sendMessage;
inputMsg.addEventListener("keydown", e => { if(e.key==="Enter") sendMessage() });

// ðŸ”¹ Ã‰couter les nouveaux messages
db.ref("messages").on("child_added", snap => {
  const m = snap.val();
  const div = document.createElement("div");
  const me = (m.nick === nickEl.value);
  div.className = "msg " + (me ? "mine" : "other");

  let adminTag = m.admin ? `<span class="adminTag">[Admin]</span>` : "";
  div.innerHTML = `<img class="avatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"> 
                   <strong>${m.nick}${adminTag}:</strong> ${m.text}
                   <div class="meta">${new Date(m.t).toLocaleTimeString()}</div>`;
  msgEl.appendChild(div);
  msgEl.scrollTop = msgEl.scrollHeight;
});
</script>
</body>
</html>
